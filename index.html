<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mattezoo</title>
<style>
  body{
    font-family: Arial, sans-serif;
    background:#eef2f7;
    margin:0;
    padding:24px 14px 40px;
  }
  #app{
    max-width:1000px;
    margin:0 auto;
    background:#fff;
    border-radius:14px;
    box-shadow:0 6px 22px rgba(0,0,0,0.09);
    border-top:6px solid #4CAF50;
    padding:18px 18px 22px;
    position:relative;
  }
  h1{margin:0 0 6px; color:#2e7d32;}
  p{margin:8px 0 10px; line-height:1.35;}
  .muted{color:#566; font-size:14px;}
  .row{display:flex; gap:14px; flex-wrap:wrap;}
  .card{
    background:#fff;
    border:1px solid #e6e6e6;
    border-radius:12px;
    padding:12px;
    box-shadow:0 2px 10px rgba(0,0,0,0.05);
  }

  /* Star pill */
  #starPill{
    position:absolute; top:14px; right:14px;
    background:#fffde7;
    border:1px solid #ffe082;
    border-radius:999px;
    padding:7px 12px;
    display:flex; align-items:center; gap:8px;
    font-weight:700; color:#f57f17;
  }
  #starPill span{font-size:18px;}
  .btn{
    border:none;
    background:#4CAF50;
    color:#fff;
    padding:9px 12px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
  }
  .btn:hover{background:#43a047;}
  .btn.secondary{background:#546e7a;}
  .btn.secondary:hover{background:#455a64;}
  .btn.danger{background:#c62828;}
  .btn.danger:hover{background:#b71c1c;}
  .btn:disabled{opacity:.5; cursor:not-allowed;}
  input, select{
    padding:9px 10px;
    border-radius:10px;
    border:1px solid #cfcfcf;
    font-size:16px;
  }

  /* Game buttons */
  #trainGrid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
    gap:12px;
    margin-top:10px;
  }
  a.gameBtn{
    text-decoration:none;
    color:#1b5e20;
    background:#f1f8e9;
    border:2px solid #c5e1a5;
    border-radius:12px;
    padding:12px;
    display:block;
    transition:transform .08s, box-shadow .08s;
  }
  a.gameBtn:hover{
    transform:translateY(-2px);
    box-shadow:0 5px 14px rgba(0,0,0,0.12);
  }
  a.gameBtn h3{margin:0 0 6px;}
  a.gameBtn p{margin:0; font-size:14px; color:#2e3d2f;}

  /* Zoo zones grid */
  #zooGrid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(240px, 1fr));
    gap:12px;
    margin-top:8px;
  }
  .zone{
    border-radius:12px;
    border:2px solid rgba(0,0,0,0.08);
    overflow:hidden;
    position:relative;
    min-height:210px;
  }
  .zoneHeader{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:10px 10px 8px;
    font-weight:800;
    font-size:14px;
  }
  .zoneBody{padding:10px;}
  .zoneDecor{
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    background:rgba(255,255,255,0.55);
    border:1px solid rgba(0,0,0,0.06);
    border-radius:10px;
    padding:8px;
    min-height:42px;
  }
  .zonePathLabel{
    font-size:12px;
    color:#345;
    margin:10px 0 6px;
    font-weight:700;
  }
  .zoneAnimals{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    background:rgba(255,255,255,0.55);
    border:1px solid rgba(0,0,0,0.06);
    border-radius:10px;
    padding:8px;
    min-height:54px;
  }
  .tile{
    width:40px; height:40px;
    display:flex; align-items:center; justify-content:center;
    border-radius:10px;
    font-size:24px;
    background:rgba(255,255,255,0.62);
    border:1px solid rgba(255,255,255,0.82);
  }

  /* Locked overlay */
  .lockedOverlay{
    position:absolute;
    inset:0;
    background:rgba(30,30,30,0.72);
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:16px;
    text-align:center;
  }
  .lockedOverlay .box{
    max-width:240px;
    background:rgba(0,0,0,0.35);
    border:1px solid rgba(255,255,255,0.25);
    border-radius:12px;
    padding:14px;
  }
  .lockedOverlay h4{margin:0 0 8px;}
  .lockedOverlay p{margin:0 0 10px; font-size:14px;}

  /* Zone color themes */
  .forest{background:#eaf6df;}
  .savannah{background:#fff6d6;}
  .ocean{background:#dbeeff;}
  .ice{background:#dff7fb;}
  .fantasy{background:#f3e3fb;}

  /* Shop */
  #shop{
    display:grid;
    grid-template-columns:1.1fr 0.9fr;
    gap:12px;
  }
  @media (max-width: 860px){
    #shop{grid-template-columns:1fr;}
  }
  .shopHeader{
    display:flex; align-items:center; gap:8px;
    font-weight:900; color:#e65100;
    margin-bottom:4px;
  }
  .shopHeader span{font-size:20px;}
  .shopControls{
    display:flex; gap:10px; flex-wrap:wrap;
    align-items:flex-end;
    margin:8px 0 10px;
  }
  .shopControls > div{display:flex; flex-direction:column; gap:6px;}
  .shopItems{
    display:flex; flex-wrap:wrap; gap:8px;
  }
  .shopItemBtn{
    border:none;
    border-radius:10px;
    padding:8px 10px;
    cursor:pointer;
    background:#ffe0b2;
    color:#5d4037;
    font-weight:800;
  }
  .shopItemBtn:hover{background:#ffcc80;}
  .shopNote{
    font-size:13px;
    color:#6d4c41;
    margin-top:8px;
  }
  .toast{
    margin-top:8px;
    font-weight:800;
    color:#2e7d32;
  }
</style>
</head>
<body>
<div id="app">
  <div id="starPill"><span>â­</span> <span id="starsText">0</span></div>

  <h1>ğŸ¦ Mattezoo</h1>
  <p>
    TrÃ¤na matte, samla stjÃ¤rnor â­ och bygg ditt zoo.
    LÃ¥s upp nya omrÃ¥den fÃ¶r <b>10 stjÃ¤rnor</b> styck!
  </p>

  <div class="row">
    <div class="card" style="flex:1; min-width:260px;">
      <b>VÃ¤lj trÃ¤ning</b>
      <div id="trainGrid">
        <a class="gameBtn" href="multiplikation.html">
          <h3>âœ–ï¸ Multiplikation</h3>
          <p>TrÃ¤na tabeller och samla â­.</p>
        </a>
        <a class="gameBtn" href="ekvationer.html">
          <h3>ğŸ§® Ekvationer</h3>
          <p>LÃ¶s ekvationer steg fÃ¶r steg.</p>
        </a>
        <a class="gameBtn" href="#" onclick="alert('Kommer snart!'); return false;">
          <h3>â— BrÃ¥k</h3>
          <p>Kommer snartâ€¦</p>
        </a>
      </div>
      <p class="muted">Tips: Om en elev vill bÃ¶rja om: anvÃ¤nd â€œNollstÃ¤llâ€ lÃ¤ngst ner.</p>
    </div>

    <div class="card" style="flex:1; min-width:260px;">
      <b>DÃ¶p ditt zoo</b>
      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:8px;">
        <input id="zooNameInput" placeholder="t.ex. Matteparken" style="flex:1; min-width:220px;">
        <button class="btn" id="saveNameBtn">Spara</button>
      </div>
      <div style="margin-top:10px;">
        <span class="muted">Just nu heter ditt zoo: </span>
        <b id="zooNameText">Mattezoo</b>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:14px;">
    <h2 style="margin:0 0 6px;">ğŸ¾ Ditt zoo</h2>
    <div class="muted">BÃ¶rja i skogen. LÃ¥s upp nÃ¤sta omrÃ¥de nÃ¤r du har 10 â­ att spendera.</div>

    <div id="zooGrid"></div>
  </div>

  <div class="card" style="margin-top:14px;">
    <div class="shopHeader"><span>ğŸª</span> DjuraffÃ¤ren & Blind Bags</div>
    <div class="muted">VÃ¤lj omrÃ¥de och kÃ¶p djur, dekorationer eller en blind bag med Ã¶verraskning ğŸ</div>

    <div id="shop">
      <div>
        <div class="shopControls">
          <div>
            <label><b>OmrÃ¥de</b></label>
            <select id="zoneSelect"></select>
          </div>
          <div>
            <label><b>KÃ¶p</b></label>
            <select id="buyMode">
              <option value="animals">Djur</option>
              <option value="decor">Dekoration</option>
              <option value="blind">Blind Bag ğŸ</option>
              <option value="unlock">LÃ¥s upp omrÃ¥de ğŸ”“</option>
            </select>
          </div>
        </div>

        <div class="shopItems" id="shopItems"></div>
        <div class="toast" id="toast"></div>
        <div class="shopNote" id="shopNote"></div>
      </div>

      <div class="card" style="background:#fafafa;">
        <b>Regler (enkla)</b>
        <ul style="margin:8px 0 0; padding-left:18px; line-height:1.35;">
          <li>Nya omrÃ¥den kostar <b>10 â­</b>.</li>
          <li>Blind bag ger ett slumpdjur frÃ¥n valt omrÃ¥de.</li>
          <li>Dekorationer hamnar â€œlÃ¤ngs stigenâ€ i omrÃ¥det.</li>
        </ul>

        <div style="margin-top:12px;">
          <button class="btn secondary" id="refreshBtn">Uppdatera sida (lÃ¤s in sparat)</button>
          <button class="btn danger" id="resetBtn" style="margin-top:8px;">NollstÃ¤ll allt</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* =========================
   STORAGE NYCKLAR
========================= */
const KEY_STARS = "mathZooStars";
const KEY_NAME = "mathZooName";
const KEY_UNLOCK = "mathZooUnlockedZones";
const KEY_ANIMALS = "mathZooAnimalsByZone";
const KEY_DECOR = "mathZooDecorByZone";

/* =========================
   DATA
========================= */
const ZONES = [
  { key:"forest",  name:"Skog",    icon:"ğŸŒ²", cls:"forest"  },
  { key:"savannah",name:"Savann",  icon:"ğŸŒµ", cls:"savannah"},
  { key:"ocean",   name:"Hav",     icon:"ğŸŒŠ", cls:"ocean"   },
  { key:"ice",     name:"Is",      icon:"â„ï¸", cls:"ice"     },
  { key:"fantasy", name:"Fantasi", icon:"ğŸ‰", cls:"fantasy" }
];

// Djur i affÃ¤ren (per zon)
const ANIMALS_BY_ZONE = {
  forest:   ["ğŸ­","ğŸ¿ï¸","ğŸ¦‰","ğŸ¦Œ","ğŸ¦Š","ğŸ»"],
  savannah: ["ğŸ¦","ğŸ¦“","ğŸ˜","ğŸ¦’","ğŸ¦›","ğŸ†"],
  ocean:    ["ğŸŸ","ğŸ¬","ğŸ™","ğŸ³","ğŸ¦€","ğŸ¦ˆ"],
  ice:      ["ğŸ§","ğŸ¦­","ğŸ»â€â„ï¸","ğŸ¦Š","ğŸ¦‰"],
  fantasy:  ["ğŸ‰","ğŸ§š","ğŸ¦„","ğŸ§™â€â™‚ï¸","ğŸ§","ğŸº"]
};

// Prislista
const PRICES = {
  animal: 3,       // â€œkÃ¶p ett djurâ€
  blind: 4,        // blind bag
  decor: 2,        // dekor
  unlock: 10
};

// Dekorationer per zon (vi â€œplacerarâ€ dem i dekor-raden)
const DECOR_BY_ZONE = {
  forest:   ["ğŸŒ²","ğŸŒ³","ğŸ„","ğŸŒ¿","ğŸŒ¼","ğŸªµ"],
  savannah: ["ğŸŒµ","ğŸŒ¾","ğŸŒ»","ğŸª¨","ğŸŒ","ğŸœï¸"],
  ocean:    ["ğŸª¸","ğŸš","ğŸŒ´","ğŸï¸","ğŸ«§","ğŸª¨"],
  ice:      ["â›„","ğŸ”ï¸","ğŸ§Š","â„ï¸","ğŸª¨","ğŸ§£"],
  fantasy:  ["âœ¨","ğŸ°","ğŸª„","ğŸ”®","ğŸŒ™","ğŸ•¯ï¸"]
};

// â€œStigâ€-dekorationer kan vi gÃ¶ra lite mer â€œspriddaâ€ genom att blanda in tomma slots
function sprinkleDecor(decorArr, targetLen=10){
  const out = decorArr.slice(0);
  while(out.length < targetLen) out.push("Â·"); // smÃ¥ â€œtomrutorâ€
  // shuffle lÃ¤tt
  for(let i=out.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [out[i],out[j]]=[out[j],out[i]];
  }
  return out;
}

/* =========================
   STATE
========================= */
let stars = 0;
let zooName = "Mattezoo";
let unlocked = { forest:true, savannah:false, ocean:false, ice:false, fantasy:false };
let animalsByZone = { forest:[], savannah:[], ocean:[], ice:[], fantasy:[] };
let decorByZone   = { forest:[], savannah:[], ocean:[], ice:[], fantasy:[] };

/* =========================
   HELPERS: STORAGE
========================= */
function loadState(){
  stars = parseInt(localStorage.getItem(KEY_STARS) || "0", 10);

  const n = localStorage.getItem(KEY_NAME);
  if(n) zooName = n;

  const u = localStorage.getItem(KEY_UNLOCK);
  if(u){
    try{
      const parsed = JSON.parse(u);
      unlocked = { ...unlocked, ...parsed };
    }catch{}
  } else {
    // default: only forest unlocked
    unlocked = { forest:true, savannah:false, ocean:false, ice:false, fantasy:false };
  }

  const a = localStorage.getItem(KEY_ANIMALS);
  if(a){
    try{
      const parsed = JSON.parse(a);
      animalsByZone = {
        forest: parsed.forest || [],
        savannah: parsed.savannah || [],
        ocean: parsed.ocean || [],
        ice: parsed.ice || [],
        fantasy: parsed.fantasy || []
      };
    }catch{}
  }

  const d = localStorage.getItem(KEY_DECOR);
  if(d){
    try{
      const parsed = JSON.parse(d);
      decorByZone = {
        forest: parsed.forest || [],
        savannah: parsed.savannah || [],
        ocean: parsed.ocean || [],
        ice: parsed.ice || [],
        fantasy: parsed.fantasy || []
      };
    }catch{}
  }

  // Om zon Ã¤r lÃ¥st ska vi inte ha djur/dekor dÃ¤r (valfritt). Jag lÃ¥ter det vara, men du kan rensa hÃ¤r om du vill.
}

function saveState(){
  localStorage.setItem(KEY_STARS, JSON.stringify(stars));
  localStorage.setItem(KEY_NAME, zooName);
  localStorage.setItem(KEY_UNLOCK, JSON.stringify(unlocked));
  localStorage.setItem(KEY_ANIMALS, JSON.stringify(animalsByZone));
  localStorage.setItem(KEY_DECOR, JSON.stringify(decorByZone));
}

/* =========================
   UI: RENDER
========================= */
function setToast(msg, good=true){
  const t = document.getElementById("toast");
  t.textContent = msg || "";
  t.style.color = good ? "#2e7d32" : "#b71c1c";
}

function updateStarsUI(){
  document.getElementById("starsText").textContent = String(stars);
}

function updateNameUI(){
  document.getElementById("zooNameText").textContent = zooName || "Mattezoo";
  document.getElementById("zooNameInput").value = zooName || "";
}

function renderZoneSelect(){
  const sel = document.getElementById("zoneSelect");
  sel.innerHTML = "";
  for(const z of ZONES){
    const opt = document.createElement("option");
    opt.value = z.key;
    opt.textContent = `${z.icon} ${z.name}`;
    sel.appendChild(opt);
  }
}

function renderZoo(){
  const grid = document.getElementById("zooGrid");
  grid.innerHTML = "";

  for(const z of ZONES){
    const zoneDiv = document.createElement("div");
    zoneDiv.className = `zone ${z.cls}`;

    const head = document.createElement("div");
    head.className = "zoneHeader";
    head.innerHTML = `<div>${z.icon} ${z.name}</div><div>${unlocked[z.key] ? "ğŸ”“" : "ğŸ”’"}</div>`;

    const body = document.createElement("div");
    body.className = "zoneBody";

    // Dekor-rad (stig)
    const label = document.createElement("div");
    label.className = "zonePathLabel";
    label.textContent = "Stig & dekorationer";

    const decor = document.createElement("div");
    decor.className = "zoneDecor";

    const decorTiles = unlocked[z.key]
      ? sprinkleDecor(decorByZone[z.key].slice(-10), 10)
      : sprinkleDecor([], 10);

    decorTiles.forEach(em => {
      const tile = document.createElement("div");
      tile.className = "tile";
      tile.style.fontSize = em === "Â·" ? "18px" : "22px";
      tile.style.opacity = em === "Â·" ? "0.25" : "1";
      tile.textContent = em;
      decor.appendChild(tile);
    });

    // Djur
    const animalsWrap = document.createElement("div");
    animalsWrap.className = "zoneAnimals";

    if(unlocked[z.key]){
      const arr = animalsByZone[z.key] || [];
      if(arr.length === 0){
        const hint = document.createElement("div");
        hint.className = "muted";
        hint.textContent = "Inga djur hÃ¤r Ã¤nnu. KÃ¶p i affÃ¤ren!";
        animalsWrap.appendChild(hint);
      } else {
        arr.forEach(em => {
          const tile = document.createElement("div");
          tile.className = "tile";
          tile.textContent = em;
          animalsWrap.appendChild(tile);
        });
      }
    } else {
      const hint = document.createElement("div");
      hint.className = "muted";
      hint.textContent = "LÃ¥st omrÃ¥de. LÃ¥s upp i affÃ¤ren fÃ¶r 10 â­.";
      animalsWrap.appendChild(hint);
    }

    body.appendChild(label);
    body.appendChild(decor);
    body.appendChild(document.createElement("div")).style.height="10px";
    body.appendChild(animalsWrap);

    zoneDiv.appendChild(head);
    zoneDiv.appendChild(body);

    // Locked overlay
    if(!unlocked[z.key]){
      const ov = document.createElement("div");
      ov.className = "lockedOverlay";
      const box = document.createElement("div");
      box.className = "box";
      box.innerHTML = `<h4>${z.name} Ã¤r lÃ¥st ğŸ”’</h4>
        <p>Kostar <b>10 â­</b> att lÃ¥sa upp.</p>`;
      const btn = document.createElement("button");
      btn.className = "btn";
      btn.textContent = `LÃ¥s upp ${z.name} (10â­)`;
      btn.disabled = stars < PRICES.unlock;
      btn.onclick = () => unlockZone(z.key);
      box.appendChild(btn);
      ov.appendChild(box);
      zoneDiv.appendChild(ov);
    }

    grid.appendChild(zoneDiv);
  }
}

function renderShop(){
  const mode = document.getElementById("buyMode").value;
  const zone = document.getElementById("zoneSelect").value;
  const items = document.getElementById("shopItems");
  const note = document.getElementById("shopNote");
  items.innerHTML = "";
  setToast("");

  // Info-lapp
  if(mode === "animals"){
    note.innerHTML = `Pris: <b>${PRICES.animal} â­</b> per djur.`;
  } else if(mode === "decor"){
    note.innerHTML = `Pris: <b>${PRICES.decor} â­</b> per dekoration. (Placeras lÃ¤ngs stigen)`;
  } else if(mode === "blind"){
    note.innerHTML = `Pris: <b>${PRICES.blind} â­</b> per blind bag ğŸ (slumpdjur).`;
  } else {
    const next = nextLockedZoneKey();
    if(!next){
      note.innerHTML = `Alla omrÃ¥den Ã¤r upplÃ¥sta âœ…`;
    } else {
      const zn = ZONES.find(z=>z.key===next).name;
      note.innerHTML = `NÃ¤sta lÃ¥sta omrÃ¥de: <b>${zn}</b>. Pris: <b>${PRICES.unlock} â­</b>.`;
    }
  }

  if(mode === "unlock"){
    const next = nextLockedZoneKey();
    if(!next){
      const done = document.createElement("div");
      done.className = "muted";
      done.textContent = "Alla omrÃ¥den Ã¤r redan upplÃ¥sta.";
      items.appendChild(done);
      return;
    }
    const zn = ZONES.find(z=>z.key===next);
    const btn = document.createElement("button");
    btn.className = "shopItemBtn";
    btn.textContent = `ğŸ”“ LÃ¥s upp ${zn.icon} ${zn.name} (${PRICES.unlock}â­)`;
    btn.disabled = stars < PRICES.unlock;
    btn.onclick = () => unlockZone(next);
    items.appendChild(btn);
    return;
  }

  // Om zonen Ã¤r lÃ¥st, lÃ¥t dem inte kÃ¶pa dit (tydligt)
  if(!unlocked[zone]){
    const msg = document.createElement("div");
    msg.className = "muted";
    msg.textContent = "Det hÃ¤r omrÃ¥det Ã¤r lÃ¥st. LÃ¥s upp det fÃ¶rst.";
    items.appendChild(msg);
    return;
  }

  if(mode === "animals"){
    (ANIMALS_BY_ZONE[zone] || []).forEach(em => {
      const btn = document.createElement("button");
      btn.className = "shopItemBtn";
      btn.textContent = `${em} KÃ¶p (${PRICES.animal}â­)`;
      btn.disabled = stars < PRICES.animal;
      btn.onclick = () => buyAnimal(zone, em);
      items.appendChild(btn);
    });
    return;
  }

  if(mode === "decor"){
    (DECOR_BY_ZONE[zone] || []).forEach(em => {
      const btn = document.createElement("button");
      btn.className = "shopItemBtn";
      btn.textContent = `${em} Dekor (${PRICES.decor}â­)`;
      btn.disabled = stars < PRICES.decor;
      btn.onclick = () => buyDecor(zone, em);
      items.appendChild(btn);
    });
    return;
  }

  if(mode === "blind"){
    const btn = document.createElement("button");
    btn.className = "shopItemBtn";
    btn.textContent = `ğŸ KÃ¶p Blind Bag (${PRICES.blind}â­)`;
    btn.disabled = stars < PRICES.blind;
    btn.onclick = () => buyBlindBag(zone);
    items.appendChild(btn);

    const extra = document.createElement("div");
    extra.className = "muted";
    extra.style.marginTop = "8px";
    extra.textContent = "Du fÃ¥r ett slumpdjur frÃ¥n omrÃ¥det. Ibland fÃ¥r du nÃ¥got lite ovanligareâ€¦";
    items.appendChild(extra);
  }
}

/* =========================
   ACTIONS
========================= */
function nextLockedZoneKey(){
  // lÃ¥s upp i ordning: forest -> savannah -> ocean -> ice -> fantasy
  for(const z of ZONES){
    if(!unlocked[z.key]) return z.key;
  }
  return null;
}

function unlockZone(zoneKey){
  if(unlocked[zoneKey]) return;
  if(stars < PRICES.unlock){
    setToast("Du har inte tillrÃ¤ckligt med stjÃ¤rnor.", false);
    return;
  }
  stars -= PRICES.unlock;
  unlocked[zoneKey] = true;
  saveState();
  updateStarsUI();
  renderZoo();
  renderShop();
  setToast(`ğŸ”“ Du lÃ¥ste upp ${ZONES.find(z=>z.key===zoneKey).name}!`);
}

function buyAnimal(zoneKey, emoji){
  if(stars < PRICES.animal) return;
  stars -= PRICES.animal;
  animalsByZone[zoneKey].push(emoji);
  saveState();
  updateStarsUI();
  renderZoo();
  renderShop();
  setToast(`Du kÃ¶pte ${emoji} till ${ZONES.find(z=>z.key===zoneKey).name}!`);
}

function buyDecor(zoneKey, emoji){
  if(stars < PRICES.decor) return;
  stars -= PRICES.decor;
  decorByZone[zoneKey].push(emoji);
  saveState();
  updateStarsUI();
  renderZoo();
  renderShop();
  setToast(`Dekoration ${emoji} placerades i ${ZONES.find(z=>z.key===zoneKey).name}!`);
}

function buyBlindBag(zoneKey){
  if(stars < PRICES.blind) return;
  stars -= PRICES.blind;

  // Enkel â€œraritetâ€: 15% chans att fÃ¥ ett â€œspecialdjurâ€ (om vi har)
  const specials = {
    forest:["ğŸ¦„"], savannah:["ğŸ²"], ocean:["ğŸ¦ˆ"], ice:["ğŸ»â€â„ï¸"], fantasy:["ğŸ‰","ğŸ¦„"]
  };
  let pick = null;
  if(Math.random() < 0.15 && (specials[zoneKey]||[]).length){
    const arr = specials[zoneKey];
    pick = arr[Math.floor(Math.random()*arr.length)];
  } else {
    const arr = ANIMALS_BY_ZONE[zoneKey] || [];
    pick = arr[Math.floor(Math.random()*arr.length)];
  }

  animalsByZone[zoneKey].push(pick);
  saveState();
  updateStarsUI();
  renderZoo();
  renderShop();
  setToast(`ğŸ Blind Bag! Du fick: ${pick}`);
}

/* =========================
   INIT / EVENTS
========================= */
function init(){
  loadState();
  updateStarsUI();
  updateNameUI();
  renderZoneSelect();
  renderZoo();

  document.getElementById("saveNameBtn").addEventListener("click", () => {
    const v = (document.getElementById("zooNameInput").value || "").trim();
    zooName = v || "Mattezoo";
    saveState();
    updateNameUI();
    setToast("Zoonamnet sparades!");
  });

  document.getElementById("buyMode").addEventListener("change", renderShop);
  document.getElementById("zoneSelect").addEventListener("change", renderShop);

  document.getElementById("refreshBtn").addEventListener("click", () => {
    init(); // lÃ¤s in igen
    setToast("Uppdaterat!");
  });

  document.getElementById("resetBtn").addEventListener("click", () => {
    if(!confirm("Vill du nollstÃ¤lla allt? (stjÃ¤rnor, djur, upplÃ¥sningar)")) return;
    localStorage.removeItem(KEY_STARS);
    localStorage.removeItem(KEY_NAME);
    localStorage.removeItem(KEY_UNLOCK);
    localStorage.removeItem(KEY_ANIMALS);
    localStorage.removeItem(KEY_DECOR);
    // reset runtime
    stars = 0;
    zooName = "Mattezoo";
    unlocked = { forest:true, savannah:false, ocean:false, ice:false, fantasy:false };
    animalsByZone = { forest:[], savannah:[], ocean:[], ice:[], fantasy:[] };
    decorByZone = { forest:[], savannah:[], ocean:[], ice:[], fantasy:[] };
    saveState();
    updateStarsUI();
    updateNameUI();
    renderZoo();
    renderShop();
    setToast("Allt Ã¤r nollstÃ¤llt.");
  });

  renderShop();
}

init();
</script>
</body>
</html>
